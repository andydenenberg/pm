<div class="container-fluid">
  <div class="row">
      <nav class="col-md-2 d-none d-md-block bg-light sidebar">
        <div class="sidebar-sticky">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="<%= portfolios_path %>">
                <span data-feather="home"></span>
                Portfolios <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="<%= stocks_path %>">
                <span data-feather="file"></span>
                Stocks 
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="<%= home_path %>">
                <span data-feather="file"></span>
                Graph 
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="<%= dividends_path %>">
                <span data-feather="file"></span>
                Dividends 
              </a>
            </li>
          <li class="nav-item">
            <a class="nav-link" href="<%= histories_path %>">
              <span data-feather="home"></span>
              Utilities 
            </a>
          </li>
          </ul>

        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
          <span>Saved reports</span>
          <a class="d-flex align-items-center text-muted" href="#">
            <span data-feather="plus-circle"></span>
          </a>
        </h6>
        <ul class="nav flex-column mb-2">
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="file-text"></span>
              Current month
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="file-text"></span>
              Last quarter
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="file-text"></span>
              Social engagement
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="file-text"></span>
              Year-end sale
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">


   <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
     <h1 id='portfolio_name' class="h2">Dividends</h1>
	     <div class="btn-toolbar mb-2 mb-md-0">	
	     </div>
   </div>

  <div class="table-responsive">
	<table class="table table-bordered table-striped table-sm">
	  <thead>
	    <tr>
	      	<th>Symbol</th>
			<th class='text-right'>Shares</th>
			<th class='text-right'>Price</th>
	      	<th class='text-right'>Investment</th>
			<th class='text-right'>Annual_Divs</th>			
			<th class='text-right'>Yield</th>			
			<% @dates.each do |d| %>
		      <th class='text-right'><%= "#{Date::ABBR_MONTHNAMES[d[1]]}-#{d[0].to_s}" %></th>
			<% end %>
	    </tr>
	  </thead>

  <tbody>
			    
    <% @stock_divs.each do |sym| %>
      <tr>
	    <td><%= sym[0] %></td>
	    <td class='text-right'><%= number_with_precision(sym[2], precision: 2, delimiter: ',') %></td>
	    <td class='text-right'><%= number_to_currency(Stock.find_by_symbol(sym[0]).price) %></td>
	    <td class='text-right'><%= number_to_currency(sym[2] * Stock.find_by_symbol(sym[0]).price) %></td>
	    <td class='text-right'><%= number_to_currency(sym[3]) %></td>
	    <td class='text-right'><%= number_to_percentage( sym[4] ) %></td>
		<% @dates.each do |year,month| %>
			<% val = sym[1].select { |d| d[1] == month and d[0] == year }.sum(0) { |t| t[2].to_f * sym[2].to_f } %>
			<% value = val != 0 ? number_to_currency(val) : '' %>
        <td class='text-right'><%= value %></td>
		<% end %>
	 </tr>
    <% end %>

	<tr>
		<td></td>
		<td></td>
		<td></td>
		<td class='text-right'><%= number_to_currency(@value_stock_total) %></td>
		<td></td>
		<td class='text-right'></td>
		<% @current_year.each do |cy| %>
		    <td class='text-right'><%= number_to_currency(cy) %></td>
		<% end %>
	</tr>

	<tr>
		<td colspan=4 class='text-right'>Annualized</td>
		<td class='text-right'><%= number_to_currency(@monthly_stock_divs_total) %></td>
		<td class='text-right'><%= number_to_percentage( 100 * (@monthly_stock_divs_total/@value_stock_total) ) %></td>
		<% @dates.each do |year,month| %>
		    <td class='text-right'><%= number_to_currency(@annual_stock_divs_total[month]) %></td>
		<% end %>
	</tr>
  </tbody>
</table>

<br>
Last Updated: <%= time_ago_in_words Dividend.all.order(updated_at: :asc).last.updated_at %> ago
<br><br><br><br>

    </main>
  </div>
</div>

<script>
$(document).ready(function() {
  feather.replace() ;	
 });
</script>
