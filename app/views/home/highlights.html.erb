<!DOCTYPE html>
<html>
  <head>
    <title>Her</title>
    <%= csrf_meta_tags %>

<meta name="viewport" content="width=device-width, initial-scale=1">

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.7.0/moment.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
	
	
	<%= javascript_include_tag "https://www.gstatic.com/charts/loader.js" %>
	
	
  </head>

<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">

<style>
/* stylelint-disable selector-list-comma-newline-after */

body {
  padding-top: 0
}

body .table {
  font-size: .90rem;
}

.blog-header {
  line-height: 1;
}

.blog-header-logo {
  font-family: "Playfair Display", Georgia, "Times New Roman", serif;
  font-size: 2rem;
}

.blog-header-logo:hover {
  text-decoration: none;
}

h1, h2, h3, h4, h5, h6 {
  font-family: "Playfair Display", Georgia, "Times New Roman", serif;
}

.display-4 {
  font-size: 2.5rem;
}
@media (min-width: 768px) {
  .display-4 {
    font-size: 3rem;
  }
}

.nav-scroller {
  position: relative;
  z-index: 2;
  height: 2.75rem;
  overflow-y: hidden;
}

.nav-scroller .nav {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: nowrap;
  flex-wrap: nowrap;
  padding-bottom: 1rem;
  margin-top: -1px;
  overflow-x: auto;
  text-align: center;
  white-space: nowrap;
  -webkit-overflow-scrolling: touch;
}

.nav-scroller .nav-link {
  padding-top: .75rem;
  padding-bottom: .75rem;
  font-size: .875rem;
}


.flex-auto {
  -ms-flex: 0 0 auto;
  -webkit-box-flex: 0;
  flex: 0 0 auto;
}

.h-250 { height: 250px; }
@media (min-width: 768px) {
  .h-md-250 { height: 250px; }
}

.border-top { border-top: 1px solid #e5e5e5; }
.border-bottom { border-bottom: 1px solid #e5e5e5; }

.box-shadow { box-shadow: 0 .25rem .75rem rgba(0, 0, 0, .05); }

/*
 * Blog name and description
 */
.blog-title {
  margin-bottom: 0;
  font-size: 2rem;
  font-weight: 400;
}
.blog-description {
  font-size: 1.1rem;
  color: #999;
}

@media (min-width: 40em) {
  .blog-title {
    font-size: 3.5rem;
  }
}

/* Pagination */
.blog-pagination {
  margin-bottom: 4rem;
}
.blog-pagination > .btn {
  border-radius: 2rem;
}

/*
 * Blog posts
 */
.blog-post {
  margin-bottom: 4rem;
}
.blog-post-title {
  margin-bottom: .25rem;
  font-size: 2.5rem;
}
.blog-post-meta {
  margin-bottom: 1.25rem;
  color: #999;
}

/*
 * Footer
 */
.blog-footer {
  padding: 2.5rem 0;
  color: #999;
  text-align: center;
  background-color: #f9f9f9;
  border-top: .05rem solid #e5e5e5;
}
.blog-footer p:last-child {
  margin-bottom: 0;
}

/* borderless table */
.table.table-borderless td, .table.table-borderless th {
    border: 0 !important;
}

.table.table-borderless {
    margin-bottom: 0px;
}
</style>


<div class="container">
	  <header class="blog-header py-3">
	    <div class="row flex-nowrap justify-content-between align-items-center">
	      <div class="col-1">
		    <a class="btn btn-sm btn-outline-secondary" href="#">Sign in</a>		
	      </div>
	      <div class="col-3 d-flex justify-content-end align-items-center">
			<%= link_to 'Info', info_path, class: "float-right btn btn-sm btn-outline-secondary" %>
			<%= link_to 'Highlights', highlights_path, class: "active float-right btn btn-sm btn-outline-secondary" %>
			<%= link_to 'Reports', consolidated_path, class: "float-right btn btn-sm btn-outline-secondary" %>
	      </div>

	      <div class="col-4 text-center">
	        <a class="blog-header-logo text-dark" href="#">Portfolio Manager</a>
	      </div>

	      <div class="col-4 d-flex justify-content-end align-items-center">
	      </div>


	    </div>
	  </header>


<table border=0>
	<tr>
		<td class="align-top pl-2 pt-2 pr-2"> 
		  <strong class="d-inline-block mb-2 text-primary">Portfolios</strong>
	      <table class='table table-sm'>
			<thead>
			<tr>
				<th>Name</th>
				<th class='text-right'>Value</th>
				<th class='text-right'>Change</th>
			</tr>
			</thead>
			<tbody>
			<% @portfolios_data[0].each do |p| %>
			<tr>
				<td><%= link_to p.name, highlights_modal_path(portfolio_name: p.name, port_gl: 'port'), remote: true %></td>
				<td class='text-right'><%= number_to_currency(p.cash+p.total_stocks_value + p.total_options_value, precision: 0) %></td>
				<td class='text-right'><%= number_to_currency(p.total_stocks_change_value, precision: 0) %></td>
			</tr>
			<% end %>
			<tr>
				<td></td>
				<td class='text-right'><%= number_to_currency(Portfolio.all.sum { |s| s.total_stocks_value } +
															  Portfolio.all.sum { |s| s.cash } +
															  Portfolio.all.sum { |s| s.total_options_value }	, precision: 0) %></td>
				<td class='text-right'><%= number_to_currency(Portfolio.all.sum { |s| s.total_stocks_change_value }	, precision: 0) %></td>
			</tr>
			</tbody>
		 </table>		
        </td>
		<td><table border=0>
			<tr>
				<td class="align-top pl-2 pt-2 pr-2">
			  <strong class="d-inline-block mb-2 text-primary">Gainers</strong>
		      <table class='table table-sm'>
				<thead>
				<tr>
					<th>Symbol</th>
					<th class='text-right'>Price</th>
					<th class='text-right'>Change</th>
				</tr>
				</thead>
				<tbody>
			    <% @winners[0..6].each do |stock| %>
			      <tr>			
			        <td><%= link_to stock[0], highlights_modal_path(symbol: stock[0], port_gl: 'gl'), remote: true %></td>
					<td class='toggleDisplay in text-right'><%= number_to_currency( stock[5].to_f ) %> (<%= number_to_currency( stock[6].to_f ) %>)</td>
					<td class='toggleDisplay in text-right'><%= number_to_currency(stock[3], precision: 0) %></td>
				</tr>
				<% end %>
				</tbody>
			  </table>
	          </td>
				<td class="align-top pl-2 pt-2 pr-2">

					<strong class="d-inline-block mb-2 text-primary">Loosers</strong>
			      <table class='table table-sm'>
					<thead>
					<tr>
						<th>Symbol</th>
						<th class='text-right'>Price</th>
						<th class='text-right'>Change</th>
					</tr>
					</thead>
					<tbody>
				    <% @loosers[0..6].each do |stock| %>
				      <tr>
				        <td><%= link_to stock[0], highlights_modal_path(symbol: stock[0], port_gl: 'gl'), remote: true %></td>
						<td class='toggleDisplay in text-right'><%= number_to_currency( stock[5].to_f ) %> (<%= number_to_currency( stock[6].to_f ) %>)</td>
						<td class='toggleDisplay in text-right'><%= number_to_currency(stock[3], precision: 0) %></td>
					</tr>
					<% end %>
					</tbody>
				  </table>





		      </td>
			</tr>
			<tr>
				<td class="align-top pl-2 pt-2 pr-2">

					<strong class="d-inline-block mb-2 text-primary">Recent Dividends</strong>
				  <table class='table table-sm'>
						<thead>
						<tr>
							<th>Symbol</th>
							<th>When</th>
							<th>per Share</th>
							<th>Total</th>
						</tr>
						</thead>
						<tbody>
					    <% @dividends[0..6].each do |div| %>
					      <tr>
					        <td><%= div.symbol %></td>
							<td class='text-right'> <%= time_ago_in_words (div.date) %> ago</td>
							<td class='text-right'> <%= number_to_currency( div.amount ) %>/share</td>
							<td class='text-right'> <%= number_to_currency( div.amount * Stock.where(symbol: div.symbol).sum(0) { |s| s.quantity }, precision: 0 ) %></td>
						</tr>
						<% end %>
						</tbody>
				  </table>


				</td>
				<td class="align-top pl-2 pt-2 pr-5">
					
					
						<strong class="d-inline-block mb-2 text-primary">History</strong>
					<%= line_chart History.where(portfolio_id: 9999, snapshot_date: Date.today.beginning_of_year..Date.today).collect { |h| [ h.snapshot_date.strftime("%-m/%-d"), h.total ]  }, thousands: ",", prefix: "$", min: 27000000, max: 32000000 %>		
					
			  </td>
			</tr>
			</table>
		</td>
	</tr>
</table>
		
		
	

</div><!-- container -->




<!-- The Modal -->
<div class="modal" id="highlightsModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal body -->
	  <div id='highlightsModal_table'></div>
	
      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>



<footer class="blog-footer">
  <p>Portfolios @AMD</p>
  <p>
    <a href="#">Back to top</a>
  </p>
</footer>